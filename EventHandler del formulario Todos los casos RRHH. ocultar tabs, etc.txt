/// <summary>
/// DMIPCR-001 
/// </summary>
class CaseDetail_APPS_PM_EXT_EventHandler
{    

    /// <summary>
    /// Enables Contractype Field based on Position Id
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormControlEventHandler(formControlStr(CaseDetail, RecruitmentAndSelectionGroup_PositionId), FormControlEventType::Modified)]
    public static void RecruitmentAndSelectionGroup_PositionId_OnModified(FormControl sender, FormControlEventArgs e)
    {
        HcmPosition hcmposition;
        HcmPositionDetail   posDetail;
        FormRun formRun               = sender.formRun();
        FormStringControl             positionId      = sender.formRun().design().controlName(formControlStr(CaseDetail, RecruitmentAndSelectionGroup_PositionId));
        FormStringControl             contractType    = sender.formRun().design().controlName(formControlStr(CaseDetail, PositionInformationGroup_ContractType));
        APPSPMEntryCardTable          entryCardTable  = formRun.dataSource(formdatasourcestr(CaseDetail, APPSPMEntryCardTable)).cursor();

        if(positionId.valueStr())
        {
            select hcmposition
                where hcmposition.PositionId == positionId.valueStr()
                join posDetail
                where posDetail.Position == hcmposition.RecId;

            entryCardTable.ContractType = HcmPositionType::find(posDetail.PositionType).TypeId;

            if(entryCardTable.ContractType)
            {
                contractType.allowEdit(false);
            }
            else
            {
                contractType.allowEdit(true);
            }
        }
        else
        {
            contractType.allowEdit(true);
        }
    }

    /// <summary>
    /// Post event handler for <c>CaseDetail</c> <c>APPSPMEntryCardTable</c> Initialized event.
    /// </summary>
    /// <param name=“_sender”></param>
    /// <param name=“_e”></param>
    [FormDataSourceEventHandler(formDataSourceStr(CaseDetail, APPSPMEntryCardTable), FormDataSourceEventType::Initialized)]
    public static void CaseDetail_OnInitialized(FormDataSource _sender, FormDataSourceEventArgs _e)
    {
        FormRun formRun                              = _sender.formRun();
        var overrides                                = CaseDetail_APPS_PM_ExtensionOverrides::construct();
        DimensionHierarchyId    dimensionHierarchyId = DimensionHierarchy::findByTypeAndName(DimensionHierarchyType::AccountStructure, BudgetParameters::find().DimensionHierarchyId).RecId;
        SegmentedEntryControl   approvedDimension    = formRun.design().controlName(formControlStr(CaseDetail, LedgerDimensionApproved));
        SegmentedEntryControl   solicitedDimension   = formRun.design().controlName(formControlStr(CaseDetail, LedgerDimensionRequested));
        CaseDetailBase          caseDetailBase       = formRun.dataSource(formdatasourcestr(CaseDetail, CaseDetailBase)).cursor();
        FormTabPageControl      entryCardTabPage     = formRun.design().controlName(formControlStr(CaseDetail, EntryCardTabPage));
        //19949 <start>
        FormReferenceGroupControl             dirName              = formRun.design().controlName(formControlStr(CaseDetail, DirPartyTable_Name));
        //19949 <end>
        CaseCategoryHierarchyDetail categoryDetail;
 
        if(APPSPMHelper::isFSPActive(APPSPMFunctionalSolutionProduct::FSP002HR))
        {
            _sender.object(fieldNum(APPSPMEntryCardTable, RefPointIdApproved)).registerOverrideMethod(methodStr(FormDataObject, lookup),
                methodStr(CaseDetail_APPS_PM_ExtensionOverrides, refPointId_lookup), overrides);

            _sender.object(fieldNum(APPSPMEntryCardTable, RefPointIdRequested)).registerOverrideMethod(methodStr(FormDataObject, lookup),
                methodStr(CaseDetail_APPS_PM_ExtensionOverrides, refPointId_lookup), overrides);

            _sender.object(fieldNum(APPSPMEntryCardTable, PositionId)).registerOverrideMethod(methodStr(FormDataObject, lookup),
                methodStr(CaseDetail_APPS_PM_ExtensionOverrides, positionLookup), overrides);

            if(dimensionHierarchyId)
            {
                solicitedDimension.setAccountStructure(dimensionHierarchyId);
                approvedDimension.setAccountStructure(dimensionHierarchyId);
            }

            categoryDetail = CaseCategoryHierarchyDetail::find(caseDetailBase.CategoryRecId);

            if(categoryDetail.PreFeasability)
            {
                entryCardTabPage.visible(true);
            }
            else
            {
                entryCardTabPage.visible(false);
            }

            //19949 <start>
            if(caseDetailBase.NN == NoYes::Yes)
            {
                dirName.allowEdit(false);
                //KCL
                dirName.mandatory(false);
                //KCL
            }
            else
            {
                dirName.allowEdit(true);
                dirName.mandatory(true);
            }
        }
        
    }

    /// <summary>
    /// Enables/disables field Name based on NN
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormDataFieldEventHandler(formDataFieldStr(CaseDetail, CaseDetailBase, NN), FormDataFieldEventType::Modified)]
    public static void NN_OnModified(FormDataObject sender, FormDataFieldEventArgs e)
    {
        FormRun             formRun        = sender.datasource().formRun();
        CaseDetailBase      caseDetailBase = formRun.dataSource(formdatasourcestr(CaseDetail, CaseDetailBase)).cursor();
        //KCL
        //FormControl       dirName                       = formRun.design().controlName(formControlStr(CaseDetail, DirPartyTable_Name));
        FormReferenceGroupControl     dirName = formRun.design().controlName(formControlStr(CaseDetail, DirPartyTable_Name));
        //KCL

        if(APPSPMHelper::isFSPActive(APPSPMFunctionalSolutionProduct::FSP002HR))
        {
            if(caseDetailBase.NN == NoYes::Yes)
            {
                //dirName.allowEdit(false);
                //KCL                  
                dirName.mandatory(false);
                dirName.enabled(false);
                //KCL
            }
            else
            {
                //dirName.allowEdit(true);
                dirName.mandatory(true);
                dirName.enabled(true);
            }
        }
        //19949 <end>
    }

    /// <summary>
    /// Bug NN_Name field mandatory
    /// </summary>
    /// <param name="sender">FormDataSource</param>
    /// <param name="e">FormDataSourceEventArgs</param>
    [FormDataSourceEventHandler(formDataSourceStr(CaseDetail, CaseDetailBase), FormDataSourceEventType::ValidatingWrite)]
    public static void CaseDetailBase_OnValidatingWrite(FormDataSource sender, FormDataSourceEventArgs e)
    {
        FormRun                     formRun = sender.formRun();
        CaseDetailBase              caseDetailBase = formRun.dataSource(formdatasourcestr(CaseDetail, CaseDetailBase)).cursor();
        FormReferenceGroupControl   dirName = formRun.design().controlName(formControlStr(CaseDetail, DirPartyTable_Name));

        if (APPSPMHelper::isFSPActive(APPSPMFunctionalSolutionProduct::FSP002HR))
        {
            if (caseDetailBase.NN)
            {
                dirName.allowEdit(false);
                dirName.mandatory(false);
            }
            else
            {
                dirName.allowEdit(true);
                dirName.mandatory(true);
            }
        }
    }

    /// <summary>
    ///
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormDataFieldEventHandler(formDataFieldStr(CaseDetail, CaseDetailBase, CategoryRecId), FormDataFieldEventType::Modified)]
    public static void CategoryRecId_OnModified(FormDataObject sender, FormDataFieldEventArgs e)
    {
        FormRun formRun         = sender.datasource().formRun();
        CaseDetailBase          caseDetailBase          = formRun.dataSource(formdatasourcestr(CaseDetail, CaseDetailBase)).cursor();
        FormTabPageControl      entryCardTabPage        = formRun.design().controlName(formControlStr(CaseDetail, EntryCardTabPage));
        FormGroupControl        SRGroup                 = formRun.design().controlName(formControlStr(CaseDetail, SRGroup));
        CaseCategoryHierarchyDetail categoryDetail;

        categoryDetail = CaseCategoryHierarchyDetail::find(caseDetailBase.CategoryRecId);

        if(APPSPMHelper::isFSPActive(APPSPMFunctionalSolutionProduct::FSP002HR))
        {
            if(categoryDetail.PreFeasability)
            {
                entryCardTabPage.visible(true);
            }
            else
            {
                entryCardTabPage.visible(false);
            }
        }

        if(APPSPMHelper::isFSPActive(APPSPMFunctionalSolutionProduct::FSP001HR))
        {
            if(categoryDetail.APPSPMIsSubstitutionReplacement)
            {
                SRGroup.visible(true);
            }
            else
            {
                SRGroup.visible(false);
            }
        }
    }

    /// <summary>
    /// Post event handler for <c>CaseDetail</c> <c>APPSPMEntryCardTable</c> Initialized event.
    /// </summary>
    /// <param name=“_sender”></param>
    /// <param name=“_e”></param>
    [FormDataSourceEventHandler(formDataSourceStr(CaseDetail, APPSPMEntryCardTable), FormDataSourceEventType::Activated)]
    public static void CaseDetail_Activated(FormDataSource _sender, FormDataSourceEventArgs _e)
    {
        FormRun formRun         = _sender.formRun();
        CaseDetailBase          caseDetailBase          = formRun.dataSource(formdatasourcestr(CaseDetail, CaseDetailBase)).cursor();
        FormTabPageControl      entryCardTabPage        = formRun.design().controlName(formControlStr(CaseDetail, EntryCardTabPage));
        FormGroupControl        SRGroup                 = formRun.design().controlName(formControlStr(CaseDetail, SRGroup));
        FormStringControl             positionId        = formRun.design().controlName(formControlStr(CaseDetail, CaseAssociation_APPSPMPositionId));
        FormStringControl             positionSR        = formRun.design().controlName(formControlStr(CaseDetail, CaseAssociation_APPSPMPositionSR));
        CaseCategoryHierarchyDetail categoryDetail;
        CaseAssociation             caseAssociation     = formRun.dataSource(formdatasourcestr(CaseDetail, CaseAssociation)).cursor();

        categoryDetail = CaseCategoryHierarchyDetail::find(caseDetailBase.CategoryRecId);

        if(APPSPMHelper::isFSPActive(APPSPMFunctionalSolutionProduct::FSP002HR))
        {
            if(categoryDetail.PreFeasability)
            {
                entryCardTabPage.visible(true);
                //formRun.setEntryCard(); -Remove BUG18046
            }
            else
            {
                entryCardTabPage.visible(false);
            }
            
        }

        if(APPSPMHelper::isFSPActive(APPSPMFunctionalSolutionProduct::FSP001HR))
        {
            if(categoryDetail.APPSPMIsSubstitutionReplacement)
            {
                SRGroup.visible(true);
            }
            else
            {
                SRGroup.visible(false);
            }
            
            if(caseAssociation.APPSPMPositionId)
            {
                positionSR.enabled(true);
            }
            else
            {
                positionSR.enabled(false);
            }
        }
    }

    /// <summary>
    ///
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormControlEventHandler(formControlStr(CaseDetail, CaseAssociation_APPSPMPositionId), FormControlEventType::Lookup)]
    public static void CaseAssociation_APPSPMPositionId_OnLookup(FormControl sender, FormControlEventArgs e)
    {
        FormRun             formRun         = sender.formRun();
        CaseAssociation     caseAssociation = formRun.dataSource(formdatasourcestr(CaseDetail, CaseAssociation)).cursor();
        SysTableLookup      sysTableLookup  = SysTableLookup::newParameters(tableNum(HcmPosition), sender);
        Query               query           = new Query();
        QueryBuildDataSource                qbds1, qbds2, qbds3, qbds4, qbds5, qbds6;

        qbds1 = query.addDataSource(tableNum(HcmPosition));
        qbds1.addGroupByField(fieldNum(HcmPosition, PositionId));
        qbds2 = qbds1.addDataSource(tableNum(HcmPositionWorkerAssignment));//.addRange(fieldNum(HcmPositionWorkerAssignment, Worker)).value(queryValue(caseAssociation.RefRecId));
        qbds2.relations(true);
        qbds2.addRange(fieldNum(HcmPositionWorkerAssignment, Worker)).value(queryValue(caseAssociation.RefRecId));
        qbds3 = qbds1.addDataSource(tableNum(HcmPositionDetail));
        qbds3.relations(true);
        qbds4 = qbds3.addDataSource(tableNum(APPSPMLegalQualityTable));
        qbds4.relations(false);
        qbds4.addLink(fieldNum(HcmPositionDetail, LegalQualityId),fieldNum(APPSPMLegalQualityTable, LegalQuality));
        qbds5 = qbds4.addDataSource(tableNum(APPSPMEndowmentLegalQuality));
        qbds5.relations(false);
        qbds5.addLink(fieldNum(APPSPMLegalQualityTable, LegalQuality),fieldNum(APPSPMEndowmentLegalQuality, LegalQualityId));
        qbds6 = qbds5.addDataSource(tableNum(APPSPMEndowmentTable));
        qbds6.relations(false);
        qbds6.addLink(fieldNum(APPSPMEndowmentTable, EndowmentId),fieldNum(APPSPMEndowmentLegalQuality, EndowmentId));
        qbds6.addRange(fieldNum(APPSPMEndowmentTable, EndowmentType)).value(queryValue(APPSPMEndowmentType::Contract));
        qbds6.addRange(fieldNum(APPSPMEndowmentTable, EndowmentType)).value(queryValue(APPSPMEndowmentType::Plant));
        // Add the lookup columns
        sysTableLookup.addLookupfield(fieldNum(HcmPosition, PositionId));

        // Run the lookup
        sysTableLookup.parmQuery(query);
        sysTableLookup.performFormLookup();

        //cancel the call to super() to prevent the system from trying to show
        //the lookup form twice and cause an error.
        FormControlCancelableSuperEventArgs cancelableSuperEventArgs = e as FormControlCancelableSuperEventArgs;
        cancelableSuperEventArgs.CancelSuperCall();
    }

    /// <summary>
    ///
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormControlEventHandler(formControlStr(CaseDetail, CaseAssociation_APPSPMPositionSR), FormControlEventType::Lookup)]
    public static void CaseAssociation_APPSPMPositionSR_OnLookup(FormControl sender, FormControlEventArgs e)
    {
        FormRun                     formRun         = sender.formRun();
        CaseAssociation             caseAssociation = formRun.dataSource(formdatasourcestr(CaseDetail, CaseAssociation)).cursor();
        APPSPMEndowmentTable        endowmentTable;
        APPSPMEndowmentLegalQuality endowmentLegalQuality;
        SysTableLookup              sysTableLookup  = SysTableLookup::newParameters(tableNum(HcmPosition), sender);
        Query                       query           = new Query();
        QueryBuildDataSource        qbds1, qbds3, qbds4, qbds5, qbds6;


        endowmentLegalQuality = APPSPMEndowmentLegalQuality::findLegalQuality(caseAssociation.APPSPMLegalQualityId);
        
        endowmentTable        = APPSPMEndowmentTable::find(endowmentLegalQuality.EndowmentId);

        qbds1 = query.addDataSource(tableNum(HcmPosition));
        qbds1.addGroupByField(fieldNum(HcmPosition, PositionId));
        qbds3 = qbds1.addDataSource(tableNum(HcmPositionDetail));
        qbds3.relations(true);
        qbds4 = qbds3.addDataSource(tableNum(APPSPMLegalQualityTable));
        qbds4.relations(false);
        qbds4.addLink(fieldNum(HcmPositionDetail, LegalQualityId),fieldNum(APPSPMLegalQualityTable, LegalQuality));
        qbds5 = qbds4.addDataSource(tableNum(APPSPMEndowmentLegalQuality));
        qbds5.relations(false);
        qbds5.addLink(fieldNum(APPSPMLegalQualityTable, LegalQuality),fieldNum(APPSPMEndowmentLegalQuality, LegalQualityId));
        qbds6 = qbds5.addDataSource(tableNum(APPSPMEndowmentTable));
        qbds6.relations(false);
        qbds6.addLink(fieldNum(APPSPMEndowmentTable, EndowmentId),fieldNum(APPSPMEndowmentLegalQuality, EndowmentId));

        if(endowmentTable.EndowmentType == APPSPMEndowmentType::Plant)
        {
            qbds6.addRange(fieldNum(APPSPMEndowmentTable, EndowmentType)).value(queryValue(APPSPMEndowmentType::Substitution));
        }

        if(endowmentTable.EndowmentType == APPSPMEndowmentType::Contract)
        {
            qbds6.addRange(fieldNum(APPSPMEndowmentTable, EndowmentType)).value(queryValue(APPSPMEndowmentType::Replacement));
        }
        // Add the lookup columns
        sysTableLookup.addLookupfield(fieldNum(HcmPosition, PositionId));
        
        // Run the lookup
        sysTableLookup.parmQuery(query);
        sysTableLookup.performFormLookup();

        //cancel the call to super() to prevent the system from trying to show
        //the lookup form twice and cause an error.
        FormControlCancelableSuperEventArgs cancelableSuperEventArgs = e as FormControlCancelableSuperEventArgs;
        cancelableSuperEventArgs.CancelSuperCall();
    }

    /// <summary>
    ///
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormControlEventHandler(formControlStr(CaseDetail, CaseAssociation_APPSPMPositionId), FormControlEventType::Modified)]
    public static void CaseAssociation_APPSPMPositionId_OnModified(FormControl sender, FormControlEventArgs e)
    {
        FormStringControl             positionId    = sender.formRun().design().controlName(formControlStr(CaseDetail, CaseAssociation_APPSPMPositionId));
        FormStringControl             positionSR    = sender.formRun().design().controlName(formControlStr(CaseDetail, CaseAssociation_APPSPMPositionSR));
        CaseAssociation          caseAssociation    = sender.formRun().dataSource(formdatasourcestr(CaseDetail, CaseAssociation)).cursor();

        if(positionId.valueStr())
        {
            positionSR.enabled(true);
        }
        else
        {
            positionSR.enabled(false);
        }
        
        caseAssociation.APPSPMPositionSR = "";
    }

    /// <summary>
    ///
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormControlEventHandler(formControlStr(CaseDetail, AssociationGrid_M_linkedId), FormControlEventType::Modified)]
    public static void AssociationGrid_M_linkedId_OnModified(FormControl sender, FormControlEventArgs e)
    {
        CaseAssociation          caseAssociation    = sender.formRun().dataSource(formdatasourcestr(CaseDetail, CaseAssociation)).cursor();

        caseAssociation.APPSPMPositionId     = "";
        caseAssociation.APPSPMLegalQualityId = "";
        caseAssociation.APPSPMEstateId       = "";
        caseAssociation.APPSPMLevelId        = "";
        caseAssociation.APPSPMFundNumber     = "";
        caseAssociation.APPSPMFundName       = "";
        caseAssociation.APPSPMPositionSR     = "";

    }

    /// <summary>
    ///
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormControlEventHandler(formControlStr(CaseDetail, APPSPMWorkerCease_PositionToCease), FormControlEventType::Lookup)]
    public static void APPSPMWorkerCease_PositionToCease_OnLookup(FormControl sender, FormControlEventArgs e)
    {
        FormControlCancelableSuperEventArgs event = e as FormControlCancelableSuperEventArgs;
        event.CancelSuperCall();

        FormRun formRun;
        FormControl formControl;
        formRun = sender.formRun();

        HcmWorker               hcmWorker;
        SysTableLookup          sysTableLookup = SysTableLookup::newParameters(tableNum(HcmPosition), sender);
        Query                   query = new Query();
        QueryBuildDataSource    qbds, qbdsWorker;
        CaseDetail              caseDetail = sender.formRun().dataSource().cursor();

        hcmWorker = hcmWorker::findByPerson(caseDetail.Party);
        if (hcmWorker)
        {
            qbds = query.addDataSource(tableNum(HcmPosition));
            qbdsWorker = qbds.addDataSource(tableNum(HcmPositionWorkerAssignment));
            qbdsWorker.joinMode(JoinMode::ExistsJoin);
            qbdsWorker.relations(true);
            qbdsWorker.addRange(fieldNum(HcmPositionWorkerAssignment, Worker)).value(queryValue(hcmWorker.RecId));

            sysTableLookup.addLookupfield(fieldNum(HcmPosition, PositionId), true);
            sysTableLookup.addLookupMethod(tableMethodStr(HcmPosition, description));

            sysTableLookup.parmQuery(query);
            sysTableLookup.performFormLookup();
        }

    }

    /// <summary>
    ///
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormDataSourceEventHandler(formDataSourceStr(CaseDetail, APPSPMWorkerCease), FormDataSourceEventType::Activated)]
    public static void APPSPMWorkerCease_OnActivated(FormDataSource sender, FormDataSourceEventArgs e)
    {
        FormStringControl LeaveTypeId = sender.formRun().design().controlName(formControlStr(CaseDetail, APPSPMWorkerCease_LeaveTypeID));
        FormDateControl  VoluntaryLayOffDate = sender.formRun().design().controlName(formControlStr(CaseDetail, APPSPMWorkerCease_VoluntaryLayoffDate));
        FormDateControl  VoluntaryLayOffRealDate = sender.formRun().design().controlName(formControlStr(CaseDetail, APPSPMWorkerCease_VoluntaryLayoffEffectiveDate));
        FormDateControl  LetterSendDate = sender.formRun().design().controlName(formControlStr(CaseDetail, APPSPMWorkerCease_LetterSendDate));
        FormDateControl  NotificationDate = sender.formRun().design().controlName(formControlStr(CaseDetail, APPSPMWorkerCease_NotificationDate));
        FormDataSource APPSPMWorkerCease_DS = sender;
        APPSPMWorkerCease  workerCease = APPSPMWorkerCease_DS.cursor();
        HcmLeaveType    hcmLeaveType;       
        
        select firstonly hcmLeaveType
            where hcmLeaveType.LeaveTypeID == workerCease.LeaveTypeID;

        if(hcmLeaveType.APPSPM_CessationsClassification == APPSPMCessationsClassification::VoluntaryWaiver)
        {
            VoluntaryLayOffDate.allowEdit(true);
            VoluntaryLayOffDate.mandatory(true);
            //workerCease.VoluntaryLayoffDate = workerCease.LastDayWorkedDate;
            VoluntaryLayOffRealDate.allowEdit(true);
            //     VoluntaryLayOffRealDate.mandatory(true);
            LetterSendDate.allowEdit(false);
            //      NotificationDate.mandatory(true);
            LetterSendDate.mandatory(false);
            workerCease.LetterSendDate = dateNull();
            workerCease.NotificationDate = dateNull();
        }
        else if(hcmLeaveType.APPSPM_CessationsClassification == APPSPMCessationsClassification::EarlyTermination)
        {
            LetterSendDate.allowEdit(true);
            LetterSendDate.mandatory(true);
            //      NotificationDate.mandatory(true);
            workerCease.VoluntaryLayoffDate = dateNull();
            VoluntaryLayOffDate.allowEdit(false);
            VoluntaryLayOffDate.mandatory(false);
            workerCease.VoluntaryLayoffEffectiveDate = dateNull();
            VoluntaryLayOffRealDate.allowEdit(false);
            VoluntaryLayOffRealDate.mandatory(false);
        }
        else
        {
            LetterSendDate.allowEdit(false);
            LetterSendDate.mandatory(false);
            workerCease.VoluntaryLayoffDate = dateNull();
            workerCease.LetterSendDate = dateNull();
            workerCease.NotificationDate = dateNull();
            workerCease.VoluntaryLayoffEffectiveDate = dateNull();
            VoluntaryLayOffDate.allowEdit(false);
            VoluntaryLayOffDate.mandatory(false);
            VoluntaryLayOffRealDate.allowEdit(false);
        }
    }

    /// <summary>
    ///
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormControlEventHandler(formControlStr(CaseDetail, APPSPMWorkerCease_LeaveTypeID), FormControlEventType::Modified)]
    public static void APPSPMWorkerCease_LeaveTypeID_OnModified(FormControl sender, FormControlEventArgs e)
    {
        FormRun formRun;
        FormControl formControl;
        formRun = sender.formRun();
        FormStringControl LeaveTypeId = sender.formRun().design().controlName(formControlStr(CaseDetail, APPSPMWorkerCease_LeaveTypeID));
        FormDateControl  VoluntaryLayOffDate = sender.formRun().design().controlName(formControlStr(CaseDetail, APPSPMWorkerCease_VoluntaryLayoffDate));
        FormDateControl  VoluntaryLayOffRealDate = sender.formRun().design().controlName(formControlStr(CaseDetail, APPSPMWorkerCease_VoluntaryLayoffEffectiveDate));
        FormDateControl  LetterSendDate = sender.formRun().design().controlName(formControlStr(CaseDetail, APPSPMWorkerCease_LetterSendDate));
        FormDateControl  NotificationDate = sender.formRun().design().controlName(formControlStr(CaseDetail, APPSPMWorkerCease_NotificationDate));
        FormDataSource APPSPMWorkerCease_DS = sender.dataSourceObject();
        APPSPMWorkerCease  workerCease = APPSPMWorkerCease_DS.cursor();
        HcmLeaveType    hcmLeaveType;

        select firstonly hcmLeaveType
            where hcmLeaveType.LeaveTypeID == workerCease.LeaveTypeID;

        if(hcmLeaveType.APPSPM_CessationsClassification == APPSPMCessationsClassification::VoluntaryWaiver)
        {
            VoluntaryLayOffDate.allowEdit(true);
            VoluntaryLayOffDate.mandatory(true);
            workerCease.VoluntaryLayoffDate = workerCease.LastDayWorkedDate;
            VoluntaryLayOffRealDate.allowEdit(true);
            //     VoluntaryLayOffRealDate.mandatory(true);
            LetterSendDate.allowEdit(false);
            //      NotificationDate.mandatory(true);
            LetterSendDate.mandatory(false);
            workerCease.LetterSendDate = dateNull();
            workerCease.NotificationDate = dateNull();
        }
        else if(hcmLeaveType.APPSPM_CessationsClassification == APPSPMCessationsClassification::EarlyTermination)
        {
            LetterSendDate.allowEdit(true);
            workerCease.LetterSendDate = today();
            //      NotificationDate.mandatory(true);
            LetterSendDate.mandatory(true);
            //      NotificationDate.mandatory(true);
            workerCease.VoluntaryLayoffDate = dateNull();
            VoluntaryLayOffDate.allowEdit(false);
            VoluntaryLayOffDate.mandatory(false);
            workerCease.VoluntaryLayoffEffectiveDate = dateNull();
            VoluntaryLayOffRealDate.allowEdit(false);
            VoluntaryLayOffRealDate.mandatory(false);
        }
        else
        {
            LetterSendDate.allowEdit(false);
            LetterSendDate.mandatory(false);
            workerCease.VoluntaryLayoffDate = dateNull();
            workerCease.LetterSendDate = dateNull();
            workerCease.NotificationDate = dateNull();
            workerCease.VoluntaryLayoffEffectiveDate = dateNull();
            VoluntaryLayOffDate.allowEdit(false);
            VoluntaryLayOffDate.mandatory(false);
            VoluntaryLayOffRealDate.allowEdit(false);
         
        }
        APPSPMWorkerCease_DS.refresh();
    }

    /// <summary>
    ///
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormControlEventHandler(formControlStr(CaseDetail, APPSPMWorkerCease_LastDayWorkedDate), FormControlEventType::Modified)]
    public static void APPSPMWorkerCease_LastDayWorkedDate_OnModified(FormControl sender, FormControlEventArgs e)
    {
        FormRun formRun;
        FormControl formControl;
        formRun = sender.formRun();
        FormStringControl LeaveTypeId = sender.formRun().design().controlName(formControlStr(CaseDetail, APPSPMWorkerCease_LeaveTypeID));
        FormDateControl  VoluntaryLayOffDate = sender.formRun().design().controlName(formControlStr(CaseDetail, APPSPMWorkerCease_VoluntaryLayoffDate));
        FormDateControl  VoluntaryLayOffRealDate = sender.formRun().design().controlName(formControlStr(CaseDetail, APPSPMWorkerCease_VoluntaryLayoffEffectiveDate));
        FormDataSource APPSPMWorkerCease_DS = sender.dataSourceObject();
        APPSPMWorkerCease  workerCease = APPSPMWorkerCease_DS.cursor();
        HcmLeaveType    hcmLeaveType;

        if(workerCease.LeaveTypeID)
        {
            select firstonly hcmLeaveType
            where hcmLeaveType.LeaveTypeID == workerCease.LeaveTypeID;
            if(hcmLeaveType.APPSPM_CessationsClassification == APPSPMCessationsClassification::VoluntaryWaiver)
            {
                workerCease.VoluntaryLayoffDate = workerCease.LastDayWorkedDate;
            }
        }
        APPSPMWorkerCease_DS.refresh();
    }

    /// <summary>
    ///
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormControlEventHandler(formControlStr(CaseDetail, APPSPMWorkerCease_VoluntaryLayoffEffectiveDate), FormControlEventType::Modified)]
    public static void APPSPMWorkerCease_VoluntaryLayoffEffectiveDate_OnModified(FormControl sender, FormControlEventArgs e)
    {
        FormRun formRun;
        FormControl formControl;
        formRun = sender.formRun();
        FormDataSource APPSPMWorkerCease_DS = sender.dataSourceObject();
        APPSPMWorkerCease  workerCease = APPSPMWorkerCease_DS.cursor();

        if(workerCease.VoluntaryLayoffEffectiveDate != dateNull())
        {
            if(workerCease.VoluntaryLayoffEffectiveDate < workerCease.LastDayWorkedDate)
            {
                Global::warning(strFmt("@APPSPM_D:APPSPM_DF0029"));
                workerCease.VoluntaryLayoffEffectiveDate = dateNull();
            }
        }
        APPSPMWorkerCease_DS.refresh();
    }

    /// <summary>
    ///
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormControlEventHandler(formControlStr(CaseDetail, APPSPMWorkerCease_CeaseDate), FormControlEventType::Modified)]
    public static void APPSPMWorkerCease_CeaseDate_OnModified(FormControl sender, FormControlEventArgs e)
    {
        FormRun formRun;
        FormControl formControl;
        formRun = sender.formRun();
        FormDataSource APPSPMWorkerCease_DS = sender.dataSourceObject();
        APPSPMWorkerCease  workerCease = APPSPMWorkerCease_DS.cursor();

        if(workerCease.CeaseDate != dateNull())
        {
            if(workerCease.CeaseDate < today())
            {
                Global::warning(strFmt("@APPSPM_D:APPSPM_DF0030"));
                workerCease.CeaseDate = dateNull();
            }
        }
        APPSPMWorkerCease_DS.refresh();
    }

    /// <summary>
    ///
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormControlEventHandler(formControlStr(CaseDetail, APPSPMWorkerCease_LastSummaryReviewDate), FormControlEventType::Modified)]
    public static void APPSPMWorkerCease_LastSummaryReviewDate_OnModified(FormControl sender, FormControlEventArgs e)
    {
        FormRun formRun;
        FormControl formControl;
        formRun = sender.formRun();
        FormDataSource APPSPMWorkerCease_DS = sender.dataSourceObject();
        APPSPMWorkerCease  workerCease = APPSPMWorkerCease_DS.cursor();

        if(workerCease.LastSummaryReviewDate != dateNull())
        {
            if(workerCease.LastSummaryReviewDate > workerCease.CeaseDate)
            {
                Global::warning(strFmt("@APPSPM_D:APPSPM_DF0031"));
                workerCease.LastSummaryReviewDate = dateNull();
            }
        }
        APPSPMWorkerCease_DS.refresh();
    }

    /// <summary>
    ///
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormControlEventHandler(formControlStr(CaseDetail, APPSPMWorkerCease_LastPaymentDayONRDate), FormControlEventType::Modified)]
    public static void APPSPMWorkerCease_LastPaymentDayONRDate_OnModified(FormControl sender, FormControlEventArgs e)
    {
        FormRun formRun;
        FormControl formControl;
        formRun = sender.formRun();
        FormDataSource APPSPMWorkerCease_DS = sender.dataSourceObject();
        APPSPMWorkerCease  workerCease = APPSPMWorkerCease_DS.cursor();

        if(workerCease.LastPaymentDayONRDate != dateNull())
        {
            if(workerCease.LastPaymentDayONRDate > workerCease.CeaseDate)
            {
                Global::warning(strFmt("@APPSPM_D:APPSPM_DF0032"));
                workerCease.LastPaymentDayONRDate = dateNull();
            }
        }
        APPSPMWorkerCease_DS.refresh();
    }

    /// <summary>
    ///
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormControlEventHandler(formControlStr(CaseDetail, APPSPMWorkerCease_VoluntaryLayoffDate), FormControlEventType::Modified)]
    public static void APPSPMWorkerCease_VoluntaryLayoffDate_OnModified(FormControl sender, FormControlEventArgs e)
    {
        FormRun formRun;
        FormControl formControl;
        formRun = sender.formRun();
        FormDataSource APPSPMWorkerCease_DS = sender.dataSourceObject();
        APPSPMWorkerCease  workerCease = APPSPMWorkerCease_DS.cursor();

        if(workerCease.VoluntaryLayoffDate != dateNull())
        {
            if(workerCease.VoluntaryLayoffDate < workerCease.LastDayWorkedDate)
            {
                Global::warning(strFmt("@APPSPM_D:APPSPM_DF0033"));
                workerCease.VoluntaryLayoffDate = dateNull();
            }
        }
        APPSPMWorkerCease_DS.refresh();
    }

    /// <summary>
    ///
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormControlEventHandler(formControlStr(CaseDetail, APPSPMWorkerCease_LetterSendDate), FormControlEventType::Modified)]
    public static void APPSPMWorkerCease_LetterSendDate_OnModified(FormControl sender, FormControlEventArgs e)
    {
        FormRun formRun;
        FormControl formControl;
        formRun = sender.formRun();
        FormDataSource APPSPMWorkerCease_DS = sender.dataSourceObject();
        APPSPMWorkerCease  workerCease = APPSPMWorkerCease_DS.cursor();
        CaseDetailBase                      caseDetailBase = sender.formRun().dataSource(FormDataSourcestr(CaseDetail,CaseDetailBase)).cursor();
        HcmPositionWorkerAssignment         hcmPositionWorker;
        HcmPositionDetail                   hcmPositionDetail;
        HcmPosition                         hcmPosition;
        APPSPMEndowmentTable            endowmentTable;

        if(workerCease.LetterSendDate != dateNull())
        {
            if(workerCease.LetterSendDate < today())
            {
                Global::warning(strFmt("@APPSPM_D:APPSPM_DF0034"));
                workerCease.LetterSendDate = dateNull();
            }
            else
            {
                if(workerCease.PositionToCease)
                {
                    select firstonly hcmPosition
                        where hcmPosition.PositionId == workerCease.PositionToCease
                    join hcmPositionDetail
                        where hcmPositionDetail.Position == hcmPosition.RecId
                    join endowmentTable
                        where endowmentTable.EndowmentId == hcmPositionDetail.LegalQualityId;
                    if(endowmentTable.EndowmentType == APPSPMEndowmentType::Fee || endowmentTable.EndowmentType == APPSPMEndowmentType::Contract)
                        workerCease.NotificationDate = workerCease.LetterSendDate;
                }
                else
                {
                    while select hcmPositionWorker
                        where hcmPositionWorker.Worker == caseDetailBase.Party
                    join hcmPosition
                        where hcmposition.RecId == hcmPositionWorker.Position
                    join hcmPositionDetail
                        where hcmPositionDetail.Position == hcmPosition.RecId
                    join endowmentTable
                        where endowmentTable.EndowmentId == hcmPositionDetail.LegalQualityId
                    {
                        if(endowmentTable.EndowmentType == APPSPMEndowmentType::Fee || endowmentTable.EndowmentType == APPSPMEndowmentType::Contract)
                        workerCease.NotificationDate = workerCease.LetterSendDate;
                    }
                }
            }
        }
        APPSPMWorkerCease_DS.refresh();
    }

    /// <summary>
    ///
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormControlEventHandler(formControlStr(CaseDetail, APPSPMWorkerCease_PositionToCease), FormControlEventType::Modified)]
    public static void APPSPMWorkerCease_PositionToCease_OnModified(FormControl sender, FormControlEventArgs e)
    {
        FormRun formRun;
        FormControl formControl;
        formRun = sender.formRun();
        FormDataSource                      APPSPMWorkerCease_DS = sender.dataSourceObject();
        APPSPMWorkerCease                   workerCease = APPSPMWorkerCease_DS.cursor();

        CaseDetailBase                      caseDetailBase = sender.formRun().dataSource().cursor();
        HcmWorker                           hcmWorker = HcmWorker::findByPerson(caseDetailBase.Party);
        HcmPosition                         hcmPosition;
        HcmPositionWorkerAssignment         hcmpositionworker;
        int c = 0;

        select count(RecId) from hcmpositionworker
            where hcmpositionworker.Worker == hcmWorker.RecId;
        if(hcmpositionworker.RecId > 1)
        {
            if(workerCease.PositionToCease)
            {
                if(Box::yesNo(strFmt("@APPSPM_D:APPSPM_DF0035",workerCease.PositionToCease), DialogButton::No) == DialogButton::No)
                {
                    workerCease.PositionToCease = "";
                }
            }          
        }       
    }

    /// <summary>
    ///
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormControlEventHandler(formControlStr(CaseDetail, CaseCatHierarchyDetail_CaseCategory), FormControlEventType::Modified)]
    public static void CaseCatHierarchyDetail_CaseCategory_OnModified(FormControl sender, FormControlEventArgs e)
    {
        FormRun formRun;
        FormControl formControl;
        formRun = sender.formRun();
        FormDataSource workerCease_DS = sender.formRun().dataSource(FormDataSourcestr(CaseDetail,APPSPMWorkerCease));
        FormDataSource CaseDetailBase_DS = sender.formRun().dataSource(FormDataSourcestr(CaseDetail,CaseDetailBase));
        CaseDetailBase  caseDetailBase = CaseDetailBase_DS.cursor();

        CaseCategoryHierarchyDetail     CaseCategoryHierarchyDetail;
       
        select firstonly CaseCategoryHierarchyDetail
            where CaseCategoryHierarchyDetail.RecId == caseDetailBase.CategoryRecId
            &&    CaseCategoryHierarchyDetail.APPSPMProcessType == APPSPMProcessType::Cease;

        if(CaseCategoryHierarchyDetail)
        {
            sender.formRun().design().controlName(formControlStr(CaseDetail,APPSPM_DFWorkerCeaseTab)).enabled(true);
        }
        else
        {
            sender.formRun().design().controlName(formControlStr(CaseDetail,APPSPM_DFWorkerCeaseTab)).enabled(false);
        }
        CaseDetailBase_DS.refresh();
        workerCease_DS.refresh();
    }

    /// <summary>
    /// DMIPCR-001
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormEventHandler(formStr(CaseDetail), FormEventType::Activated)]
    public static void CaseDetail_OnActivated(xFormRun sender, FormEventArgs e)
    {
        FormDataSource CaseDetailBaseDS = sender.dataSource(formDataSourceStr(CaseDetail,CaseDetailBase));
        FormDataSource APPSPMMobilityDependenceTableDS = sender.dataSource(formDataSourceStr(CaseDetail,APPSPMMobilityDependenceTable));
        FormDataSource APPSPMPaymentDS = sender.dataSource(formDataSourceStr(CaseDetail,APPSPMPayment));

        CaseDetailBaseDS.refresh();
        //20230602 - DMIPCR001_Bug19805 - KCL - Start
        APPSPMMobilityDependenceTableDS.research(true);
        //20230602 - DMIPCR001_Bug19805 - KCL - End
        APPSPMMobilityDependenceTableDS.refresh();
        APPSPMPaymentDS.refresh();
    }

    /// <summary>
    /// DMIPCR-001
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormControlEventHandler(formControlStr(CaseDetail, btnNewCase), FormControlEventType::Clicked)]
    public static void btnNewCase_OnClicked(FormControl sender, FormControlEventArgs e)
    {
        if (APPSPMHelper::isFSPActive(APPSPMFunctionalSolutionProduct::FSP006HR))
        {
            //Case new
            sender.formRun().design().controlName(formControlStr(CaseDetail,APPDMIMobilityDependence)).visible(false); // .enabled(false);
            sender.formRun().design().controlName(formControlStr(CaseDetail,APPDMIMobilityDependenceTab)).visible(false);//enabled(false);
            sender.formRun().design().controlName(formControlStr(CaseDetail,PaymentsTab)).visible(false);//enabled(false);
        }
    }

    /// <summary>
    /// DMIPCR-001
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormControlEventHandler(formControlStr(CaseDetail, btnNewDependentCase), FormControlEventType::Clicked)]
    public static void btnNewDependentCase_OnClicked(FormControl sender, FormControlEventArgs e)
    {
        //Case new dependent
        sender.formRun().design().controlName(formControlStr(CaseDetail,APPDMIMobilityDependence)).enabled(true);
        sender.formRun().design().controlName(formControlStr(CaseDetail,APPDMIMobilityDependenceTab)).enabled(true);
        sender.formRun().design().controlName(formControlStr(CaseDetail,PaymentsTab)).enabled(true);
    }

    /// <summary>
    /// DMIPCR-001
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormDataSourceEventHandler(formDataSourceStr(CaseDetail, APPSPMMobilityDependenceTable), FormDataSourceEventType::Activated)]
    public static void APPSPM_MobilityDependenceTable_OnActivated(FormDataSource sender, FormDataSourceEventArgs e)
    {
        FormRun formRun = sender.formRun();
        FormDataSource  formDS = sender.formRun().dataSource(FormDataSourcestr(CaseDetail, CaseDetailBase  ));
                        formDS.refresh();
        FormDataSource  mobilityDependenceTableDS = sender.formRun().dataSource(FormDataSourcestr(CaseDetail,APPSPMMobilityDependenceTable));
                        mobilityDependenceTableDS.refresh();
        CaseDetailBase caseDetailBase = formDS.cursor();
        APPSPMMobilityDependenceTable mobilityDependenceTable = mobilityDependenceTableDS.cursor();//Add by jpr
        FormControl radioControl = sender.formRun().design().controlName(formControlStr(CaseDetail,FormRadioButtonControl1));
        DimAttributeOMDepartment dimAttributeOMDepartment;
        APPSPMResolutionTable resolTable;
        APPSPMWorkerRelationTable workerRelTable;
        OMOperatingUnit OMOperatingUnit;
        APPSPMPayment APPSPMPayment;

        //20230602 - DMIPCR001_Bug19805 - KCL - Start
        FormRadioControl radioControl1 = sender.formRun().design().controlName(formControlStr(CaseDetail, FormRadioButtonControl1));
        radioControl1.selection(enum2int(mobilityDependenceTable.TypeMobility));
        FormRadioControl radioControl2 = sender.formRun().design().controlName(formControlStr(CaseDetail, FormRadioButtonControl2));
        radioControl2.selection(enum2int(mobilityDependenceTable.SelectDependency));
        //20230602 - DMIPCR001_Bug19805 - KCL - End

        //DMIPCR-001 <start> by JParroquiano
        if(mobilityDependenceTable)
        {
            if (mobilityDependenceTable.SelectDependency == APPSPMSelectDependency::Dependency) //Check Dependence is marked
            {
                if(mobilityDependenceTable.Volunteer == NoYes::Yes)
                {
                    sender.formRun().design().controlName(formControlStr(CaseDetail,PaymentsTab)).enabled(false);
                    sender.formRun().design().controlName(formControlStr(CaseDetail,APPSPMGenerateResolution)).enabled(false);
                    sender.formRun().design().controlName(formControlStr(CaseDetail,APPSPMMaintainPayrollCredits)).enabled(true);
                }
                else
                {
                    sender.formRun().design().controlName(formControlStr(CaseDetail,PaymentsTab)).enabled(true);
                    sender.formRun().design().controlName(formControlStr(CaseDetail,APPSPMGenerateResolution)).enabled(false);
                    sender.formRun().design().controlName(formControlStr(CaseDetail,APPSPMMaintainPayrollCredits)).enabled(false);
                    
                    select firstonly RecId from APPSPMPayment  //20230602 - DMIPCR001_Bug19805 - KCL
                        where APPSPMPayment.CaseId == caseDetailBase.CaseId;

                    if(APPSPMPayment)
                    {
                        sender.formRun().design().controlName(formControlStr(CaseDetail,APPSPMGenerateResolution)).enabled(true);
                    }
                }
            }
           
            //DMIPCR-003 <start> by JParroquiano
            if(mobilityDependenceTable.TypeMobility == APPSPMTypeMobility::Destination)
            {
                sender.formRun().design().controlName(formControlStr(CaseDetail,APPSPMMaintainPayrollCredits)).enabled(true);
            }
            else
            {
                sender.formRun().design().controlName(formControlStr(CaseDetail,APPSPMMaintainPayrollCredits)).enabled(false);
            }
            //DMIPCR-003 <end> by JParroquiano
        }
        else
        {
            //20230602 - DMIPCR001_Bug19805 - KCL - Start
            mobilityDependenceTable.clear();               
            //20230602 - DMIPCR001_Bug19805 - KCL - End
            
            mobilityDependenceTable.TypeMobility = APPSPMTypeMobility::InternalOrder;
            HcmPositionDetail   positionDetail = APPSPMMaintainPayrollCredits::getHcmPositionDetail(caseDetailBase);
            mobilityDependenceTable.ActualDependenceInt64 = positionDetail.Department;
            mobilityDependenceTable.CaseId = caseDetailBase.CaseId;
            mobilityDependenceTable.insert();
        }
        formDS.refresh();          
        mobilityDependenceTableDS.refresh();

    }

    /// <summary>
    /// DMIPCR-003 button Voluntari
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormControlEventHandler(formControlStr(CaseDetail, FormRadioButtonControl3), FormControlEventType::Modified)]
    public static void FormRadioButtonControl3_OnModified(FormControl sender, FormControlEventArgs e)
    {
        FormDataSource formDS = sender.formRun().dataSource(FormDataSourcestr(CaseDetail, CaseDetailBase  ));
        caseDetailBase caseDetailBase = formDS.cursor();
        FormDataSource mobilityDependenceTableDS = sender.formRun().dataSource(FormDataSourcestr(CaseDetail,APPSPMMobilityDependenceTable));
        APPSPMMobilityDependenceTable mobilityDependenceTable = mobilityDependenceTableDS.cursor();//Add by jpr
        APPSPMPayment APPSPMPayment;
        
        ttsbegin;
        if(sender.valueStr()  == enum2Value( NoYes::Yes ))//mobilityDependenceTable.Volunteer == NoYes::Yes)
        {
            sender.formRun().design().controlName(formControlStr(CaseDetail,PaymentsTab)).enabled(false);
            sender.formRun().design().controlName(formControlStr(CaseDetail,APPSPMGenerateResolution)).enabled(false);
            sender.formRun().design().controlName(formControlStr(CaseDetail,APPSPMMaintainPayrollCredits)).enabled(true);
            mobilityDependenceTable.selectForUpdate(true);
            mobilityDependenceTable.Volunteer = NoYes::Yes;
            mobilityDependenceTable.update();
        }
        else if(sender.valueStr()  == enum2Value( NoYes::No))
        {
            sender.formRun().design().controlName(formControlStr(CaseDetail,PaymentsTab)).enabled(true);
            sender.formRun().design().controlName(formControlStr(CaseDetail,APPSPMGenerateResolution)).enabled(false);
            sender.formRun().design().controlName(formControlStr(CaseDetail,APPSPMMaintainPayrollCredits)).enabled(false);
            mobilityDependenceTable.selectForUpdate(true);
            mobilityDependenceTable.Volunteer = NoYes::No;
            mobilityDependenceTable.update();

            select firstonly APPSPMPayment
                where APPSPMPayment.CaseId == caseDetailBase.CaseId;
            if(APPSPMPayment)
            {
                sender.formRun().design().controlName(formControlStr(CaseDetail,APPSPMGenerateResolution)).enabled(true);
            }
           
            formDS.refresh();
            mobilityDependenceTableDS.validateWrite();
        }
        ttscommit;
    }

    /// <summary>
    /// DMIPCR-001
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormControlEventHandler(formControlStr(CaseDetail, APPSPMGenerateResolution), FormControlEventType::Clicked)]
    public static void APPSPMGenerateResolution_OnClicked(FormControl sender, FormControlEventArgs e)
    {
        FormDataSource  CaseDetailBaseDS = sender.formRun().dataSource(FormDataSourcestr(CaseDetail,CaseDetailBase));
        FormDataSource  mobilityDependenceTableDS = sender.formRun().dataSource(FormDataSourcestr(CaseDetail,APPSPMMobilityDependenceTable));

        CaseDetailBaseDS.reread();
        CaseDetailBaseDS.refresh();
        mobilityDependenceTableDS.reread();
        mobilityDependenceTableDS.refresh();
    }

    /// <summary>
    /// DMIPCR-001
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormDataSourceEventHandler(formDataSourceStr(CaseDetail, CaseDetailBase), FormDataSourceEventType::Activated)]
    public static void CaseDetailBase_OnActivated(FormDataSource sender, FormDataSourceEventArgs e)
    {
        FormDataSource                  formDS = sender.formRun().dataSource(FormDataSourcestr(CaseDetail,CaseDetailBase));
        FormDataSource                  mobilityDependenceTableDS = sender.formRun().dataSource(FormDataSourcestr(CaseDetail,APPSPMMobilityDependenceTable));
        FormDataSource                  workerCease_DS = sender.formRun().dataSource(FormDataSourcestr(CaseDetail,APPSPMWorkerCease));
        CaseDetailBase                  caseDetailBase = formDS.cursor();
        HcmPositionDetail               HcmPositionDetail = APPSPMMaintainPayrollCredits::getHcmPositionDetail(caseDetailBase);
        mobilityDependenceTableDS.refresh();
        APPSPMMobilityDependenceTable   mobilityDependenceTable = mobilityDependenceTableDS.cursor();
        CaseCategoryHierarchyDetail     CaseCategoryHierarchyDetail;
        OMOperatingUnit                 OMOperatingUnit;
        APPSPMWorkerRelationTable       workerRelTable;
        APPSPMResolutionTable           resolTable;
        APPSPMPayment                   APPSPMPayment;
        hcmPosition                     hcmPosition;

        select firstonly CaseCategoryHierarchyDetail
            where CaseCategoryHierarchyDetail.RecId == caseDetailBase.CategoryRecId
            &&    CaseCategoryHierarchyDetail.APPSPMProcessType == APPSPMProcessType::Cease;

        if(CaseCategoryHierarchyDetail)
        {
            sender.formRun().design().controlName(formControlStr(CaseDetail,APPSPM_DFWorkerCeaseTab)).enabled(true);
        }
        else
        {
            sender.formRun().design().controlName(formControlStr(CaseDetail,APPSPM_DFWorkerCeaseTab)).enabled(false);
        }
        

        //------<DMIPCR001 add JParroquiano - begin>------
        
        select firstonly OMOperatingUnit
            where OMOperatingUnit.RecId == HcmPositionDetail.Department;
        
        if(mobilityDependenceTable.Volunteer == NoYes::Yes)
        {
            sender.formRun().design().controlName(formControlStr(CaseDetail,APPSPMMaintainPayrollCredits)).enabled(true);
            sender.formRun().design().controlName(formControlStr(CaseDetail,PaymentsTab)).enabled(false);
            sender.formRun().design().controlName(formControlStr(CaseDetail,APPSPMGenerateResolution)).enabled(false);
            sender.formRun().design().controlName(formControlStr(CaseDetail,APPSPMMaintainPayrollCredits)).enabled(true);
        }
        else
        {
            sender.formRun().design().controlName(formControlStr(CaseDetail,APPSPMMaintainPayrollCredits)).enabled(false);
            sender.formRun().design().controlName(formControlStr(CaseDetail,PaymentsTab)).enabled(true);
            sender.formRun().design().controlName(formControlStr(CaseDetail,APPSPMGenerateResolution)).enabled(false);

            select firstonly APPSPMPayment
                where APPSPMPayment.CaseId == caseDetailBase.CaseId;
            
            if (APPSPMPayment)
            {
                sender.formRun().design().controlName(formControlStr(CaseDetail,APPSPMGenerateResolution)).enabled(true);
            }
        }

        formDS.refresh();
        mobilityDependenceTableDS.refresh();          
        workerCease_DS.refresh();
        //------<DMIPCR001 add JParroquiano - end>------     
        //KCL
        if (!CaseDependency::findCase(caseDetailBase.RecId))
        {
            sender.formRun().design().controlName(formControlStr(CaseDetail, APPDMIMobilityDependenceTab)).visible(false);
            sender.formRun().design().controlName(formControlStr(CaseDetail, PaymentsTab)).visible(false);
        }
        else
        {
            sender.formRun().design().controlName(formControlStr(CaseDetail, APPDMIMobilityDependenceTab)).visible(true);
            sender.formRun().design().controlName(formControlStr(CaseDetail, PaymentsTab)).visible(true);
        }
        //KCL
    }

    /// <summary>
    /// DMIPCR-001
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormControlEventHandler(formControlStr(CaseDetail, APPSPMPayment_Amount), FormControlEventType::Modified)]
    public static void APPSPMPayment_Amount_OnModified(FormControl sender, FormControlEventArgs e)
    {
        FormDataSource CaseDetailDS = sender.formRun().dataSource(formDataSourceStr(CaseDetail,CaseDetailBase));
        CaseDetailBase CaseDetailBase =   CaseDetailDS.cursor();
        FormDataSource APPSPMPaymentDS = sender.formRun().dataSource(formDataSourceStr(CaseDetail,APPSPMPayment));
        APPSPMPayment APPSPMPaymen = APPSPMPaymentDS.cursor();
        APPSPMMobilityDependenceTable mobilityDependenceTable = APPSPMMobilityDependenceTable::find(caseDetailBase.CaseId);

        if(mobilityDependenceTable.SelectDependency == APPSPMSelectDependency::Dependency) //Check Dependence is marked
        {
            sender.formRun().design().controlName(formControlStr(CaseDetail,APPSPMGenerateResolution)).enabled(true);
            APPSPMPaymentDS.refresh();
            CaseDetailDS.refresh();
        }
        
    }

    //---------------------------------------------------------NewDependence-begin------------------------------------------------------
    /// <summary>
    /// DMIPCR-001
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormControlEventHandler(formControlStr(CaseDetail, APPSPMMobilityDependenceTable_NewDependence), FormControlEventType::Lookup)]
    public static void APPSPM_MobilityDependenceTable_NewDependence_OnLookup(FormControl sender, FormControlEventArgs e)
    {
        Query                          query = new Query();
        QueryBuildDataSource           qbds;
        QueryBuildDataSource           qbdsJoin;

        // Inicialización del lookup
        SysTableLookup                  sysTableLookup = SysTableLookup::newParameters(tableNum(OMOperatingUnit), sender);

        // Add fields
        sysTableLookup.addLookupfield( fieldNum(OMOperatingUnit, Name));
 
        // Despliega info de la tabla APPRY_VendRulingConfig
        qbds= query.addDataSource( tableNum(OMOperatingUnit));

        // Run lookup
        sysTableLookup.parmQuery(query);
        sysTableLookup.performFormLookup();

    }

    //---------------------------------------------------------NewDependence-end------------------------------------------------------


    /// <summary>
    /// DMIPCR-002
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormControlEventHandler(formControlStr(CaseDetail, RequestedContractualInformationGroup_EstateRequested), FormControlEventType::Modified)]
    public static void RequestedContractualInformationGroup_EstateRequested_OnModified(FormControl sender, FormControlEventArgs e)
    {
        APPSPMEntryCardTable cardTable =  sender.formRun().dataSource().cursor();
        CaseDetail caseDetail;
        select firstonly caseDetail where caseDetail.RecId == cardTable.CaseRecId;

        HcmEmploymentDetail HcmEmploymentDetail;
        HcmWorker HcmWorker;
        HcmEmployment HcmEmployment;
        APPSPMEstateTable estate;

        select firstonly forupdate HcmEmploymentDetail
            join HcmEmployment
                where HcmEmploymentDetail.Employment == HcmEmployment.RecId
            join HcmWorker
                where  HcmWorker.RecId == HcmEmployment.Worker
                    && HcmWorker.Person == caseDetail.Party;
    }

    /// <summary>
    /// DMIPCR-002
    /// </summary>
    /// <param name="sender"></param>
    /// <param name="e"></param>
    [FormControlEventHandler(formControlStr(CaseDetail, ApprovedContractualInformationGroup_EstateApproved), FormControlEventType::Modified)]
    public static void ApprovedContractualInformationGroup_EstateApproved_OnModified(FormControl sender, FormControlEventArgs e)
    {
        APPSPMEntryCardTable cardTable =  sender.formRun().dataSource().cursor();
        CaseDetail caseDetail;
        select firstonly caseDetail where caseDetail.RecId == cardTable.CaseRecId;

        HcmEmploymentDetail HcmEmploymentDetail;
        HcmWorker HcmWorker;
        HcmEmployment HcmEmployment;
        APPSPMEstateTable estate;

        select firstonly forupdate HcmEmploymentDetail
            join HcmEmployment
                where HcmEmploymentDetail.Employment == HcmEmployment.RecId
            join HcmWorker
                where  HcmWorker.RecId == HcmEmployment.Worker
                    && HcmWorker.Person == caseDetail.Party;

    }

    //20230602 - DMIPCR001_Bug19805 - KCL - Start
    /// <summary>
    /// SelectionChanged() of FormRadioButtonControl1 - Update value in APPSPMMobilityDependenceTable table
    /// </summary>
    /// <param name="sender">FormControl</param>
    /// <param name="e">FormControlEventArgs</param>
    [FormControlEventHandler(formControlStr(CaseDetail, FormRadioButtonControl1), FormControlEventType::SelectionChanged)]
    public static void FormRadioButtonControl1_OnSelectionChanged(FormControl sender, FormControlEventArgs e)
    {
        FormDataSource                  mobilityDependenceTableDS = sender.formRun().dataSource(FormDataSourcestr(CaseDetail, APPSPMMobilityDependenceTable));         
        APPSPMMobilityDependenceTable   mobilityDependenceTable   = mobilityDependenceTableDS.cursor();
        FormControl                     radioControl = sender.formRun().design().controlName(formControlStr(CaseDetail, FormRadioButtonControl1));
        
        if (radioControl.valueStr() == enum2Value(APPSPMTypeMobility::Destination))
            APPSPMMobilityDependenceTable::updateTypeMobility(APPSPMTypeMobility::Destination, mobilityDependenceTable);
        else
            APPSPMMobilityDependenceTable::updateTypeMobility(APPSPMTypeMobility::InternalOrder, mobilityDependenceTable);
    }

    /// <summary>
    /// SelectionChanged() of FormRadioButtonControl2 - Update value in APPSPMMobilityDependenceTable table
    /// </summary>
    /// <param name="sender">FormControl</param>
    /// <param name="e">FormControlEventArgs</param>
    [FormControlEventHandler(formControlStr(CaseDetail, FormRadioButtonControl2), FormControlEventType::SelectionChanged)]
    public static void FormRadioButtonControl2_OnSelectionChanged(FormControl sender, FormControlEventArgs e)
    {           
        FormDataSource                  mobilityDependenceTableDS = sender.formRun().dataSource(FormDataSourcestr(CaseDetail, APPSPMMobilityDependenceTable));
        APPSPMMobilityDependenceTable   mobilityDependenceTable   = mobilityDependenceTableDS.cursor();
        FormControl                     radioControl = sender.formRun().design().controlName(formControlStr(CaseDetail, FormRadioButtonControl2));
        
        FormDataSource                  caseDetailBaseDS = sender.formRun().dataSource(FormDataSourcestr(CaseDetail, CaseDetailBase));
        CaseDetailBase                  caseDetailBase = caseDetailBaseDS.cursor();
        HcmPositionDetail               positionDetail;

        if (radioControl.valueStr() == enum2Value(APPSPMSelectDependency::AppointmentCompatiblePosition))
        {
            APPSPMMobilityDependenceTable::updateSelectDependency(APPSPMSelectDependency::AppointmentCompatiblePosition, mobilityDependenceTable);
        }
        else
        {
            if (!mobilityDependenceTable.ActualDependenceInt64)
                positionDetail = APPSPMMaintainPayrollCredits::getHcmPositionDetail(caseDetailBase);

            APPSPMMobilityDependenceTable::updateSelectDependency(APPSPMSelectDependency::Dependency, mobilityDependenceTable, positionDetail);
            
            if (mobilityDependenceTable.Volunteer)
            {
                sender.formRun().design().controlName(formControlStr(CaseDetail, PaymentsTab)).enabled(false);
                sender.formRun().design().controlName(formControlStr(CaseDetail, APPSPMGenerateResolution)).enabled(false);
                sender.formRun().design().controlName(formControlStr(CaseDetail, APPSPMMaintainPayrollCredits)).enabled(true);
            }
            else
            {
                sender.formRun().design().controlName(formControlStr(CaseDetail, PaymentsTab)).enabled(true);
                sender.formRun().design().controlName(formControlStr(CaseDetail, APPSPMGenerateResolution)).enabled(false);
                sender.formRun().design().controlName(formControlStr(CaseDetail, APPSPMMaintainPayrollCredits)).enabled(false);
                 
                APPSPMPayment APPSPMPayment;

                select firstonly RecId from APPSPMPayment
                        where APPSPMPayment.CaseId == caseDetailBase.CaseId;

                if (APPSPMPayment)
                {
                    sender.formRun().design().controlName(formControlStr(CaseDetail, APPSPMGenerateResolution)).enabled(true);
                }
            }
        }
    }
    //20230602 - DMIPCR001_Bug19805 - KCL - End

}